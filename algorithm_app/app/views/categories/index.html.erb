<div class='container'>
	<h3>You have completed <%= @total_completed %>/<%= @total_challenges %>
	<table class="table table-striped table-bordered">
		<thead>
			<tr>
				<th>Category</th>
				<th>Challenges</th>
			</tr>
		</thead>
		<tbody>
			<% for category in @categories %>
				<tr>
					<td><!-- First column: catgegory with link to modal window -->
						<a data-toggle="modal" data-target="#myModal">
						  <%= category.name.to_s.strip %>
						</a>
						<!-- Modal -->
						<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						  <div class="modal-dialog">
						    <div class="modal-content">
						      <div class="modal-header">
						        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						        <h4 class="modal-title" id="myModalLabel"><%= category.name.to_s.strip %></h4>
						      </div>
						      <div class="modal-body">
						      	<% unless category.video.empty? %>
						      	 	<iframe width="560" height="315" src="<%= category.video%>" frameborder="0" allowfullscreen></iframe>
						      	 <% end %>
						        <%= category.description %>
						      </div>
						      <div class="modal-footer">
						        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						      </div>
						    </div>
						  </div>
						</div>
					</td>
					<td> <!-- contains links to challenges -->
							<% for challenge in category.challenges.order(:duration) %>
								<% unless challenge.status %> 
								 <!-- if challenge has not been completed, create link and allow modal -->
								 	<% time_in_minutes = challenge.duration.to_i/1000/60

								 		if time_in_minutes > 60 
								 			time_hours = time_in_minutes/60
								 			time_minutes = time_in_minutes - time_hours*60
								 			tooltip_message = "This challenge should take " + time_hours.to_s + " hours and " + time_minutes.to_s + " minutes to complete. Do not start unless you have the time." 
								 		else
								 			tooltip_message = "This challenge should take " + time_in_minutes.to_s + " minutes to complete. Do not start unless you have the time." 
								 		end
								 	%>

									<button type="button" class="btn btn-default btn-xs"><a data-toggle="modal" data-target="#myModal" rel="tooltip" title="<%= tooltip_message %>">
									  <%= challenge.name.to_s.strip %>
									</a></button>
									<!-- Modal -->
									<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
									  <div class="modal-dialog">
									    <div class="modal-content">
									      <div class="modal-header">
									        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									        <h4 class="modal-title" id="myModalLabel"><%= challenge.name.to_s.strip %></h4>
									      </div>
									      <div class="modal-body">
									      	<% unless challenge.video.nil? or challenge.video.empty?%>
									      	 	<iframe width="560" height="315" src="<%= category.video%>" frameborder="0" allowfullscreen></iframe>
									      	 <% end %>
									        <%= challenge.content %>
									      </div>
									      <div class="modal-footer">
									        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
									      </div>
									    </div>
									  </div>
									</div>
								<% else %> <!-- challenge completed, disable link -->
									<button type="button" class="btn btn-success btn-xs">
										  <%= challenge.name.to_s.strip %>
									</button>
								<% end %>
						<% end %>  <!-- endo of for loop for each challenge -->
					</td>
				</tr>
			<% end %>
		</tbody>
	</table>
</div>

<%= yield :javascript %> 
